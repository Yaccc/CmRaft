option java_package = "com.chicm.cmraft.protobuf.generated";
option java_outer_classname = "RaftProtos";
option java_generic_services = true;
option java_generate_equals_and_hash = true;
option optimize_for = SPEED;

message ServerId {
  required string host_name = 1;
  required uint32 port = 2;
  optional uint64 start_code = 3;
}

message RequestHeader {
  required uint32 id = 1;
  required string request_name = 2;
}

message ResponseHeader {
  required uint32 id = 1;
  required string response_name =2;
}

message HeartBeatRequest {
  required ServerId server = 1;
}

message HeartBeatResponse {
}

message ServerListRequest {
}

message ServerListResponse {
  repeated ServerId server = 1;
}

message CollectVoteRequest {
  required ServerId candidateId = 1;
  required uint64 term = 2;
  required uint64 lastLogIndex = 3;
  required uint64 lastLogTerm = 4;
}

message CollectVoteResponse {
  required ServerId fromHost = 1;
  required uint64 term = 2;
  required bool granted = 3;
}

service RaftService {
  rpc collectVote(CollectVoteRequest)
    returns(CollectVoteResponse);
    
  rpc beatHeart(HeartBeatRequest)  
    returns(HeartBeatResponse);
    
  rpc listServer(ServerListRequest) 
    returns(ServerListResponse);
}
